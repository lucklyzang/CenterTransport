webpackJsonp([18],{TBwS:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("HzJ8"),i=s.n(a),o=s("4YfN"),n=s.n(o),p=s("0eBz"),c=s("0DTB"),r=s("fFvN"),l=s("sqAx"),h=s("SJI6"),f=s("fdFc"),d=(s("M9A7"),{name:"appointDetails",data:function(){return{leftDropdownDataList:["退出登录"],leftDownShow:!1,liIndex:null,isPatienVerified:!1,isStartPonitVerified:!1,isBackStartPonitVerified:!1,drawCompleteTaskIdList:[],appointDetailsMessage:"",taskSweepCodePng:s("g5KD")}},components:{HeaderTop:p.a,NoData:l.a,FooterBottom:c.a},computed:n()({},Object(h.mapGetters)(["navTopTitle","userInfo","appointTaskMessage","completeCheckedItemInfo","completeSweepcodeDepartureInfo","completeSweepcodeDestinationInfo"]),{proId:function(){return this.userInfo.extendData.proId},userName:function(){return this.userInfo.userName},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},taskId:function(){return this.appointTaskMessage.id}}),mounted:function(){var e=this;if(!Object(f.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),7==e.appointTaskMessage.state?e.changeIsFreshAppointTaskPage(!1):e.changeIsFreshAppointTaskPage(!0),e.$router.push({path:"/appointTask"}),e.changeTitleTxt({tit:"预约任务"}),Object(f.q)("currentTitle","预约任务")})}this.changeDepartureState(),this.getAppointTaskMessage(this.appointTaskMessage.id)},methods:n()({},Object(h.mapMutations)(["changeTitleTxt","changeIsFreshAppointTaskPage","changeCompleteCheckedItemInfo","changeCompleteSweepcodeDestinationInfo","changeCompleteSweepcodeDepartureInfo"]),{backTo:function(){7==this.appointTaskMessage.state?this.changeIsFreshAppointTaskPage(!1):this.changeIsFreshAppointTaskPage(!0),this.$router.push({path:"/appointTask"}),this.changeTitleTxt({tit:"预约任务"}),Object(f.q)("currentTitle","预约任务")},stateTransfer:function(e){switch(e){case 0:return"未分配";case 1:return"未查阅";case 2:return"未开始";case 3:return"进行中";case 4:return"未结束";case 5:return"已延迟";case 6:return"已取消";case 7:return"已完成"}},priorityTransfer:function(e){switch(e){case 1:return"正常";case 2:return"重要";case 3:return"紧急";case 4:return"紧急重要"}},changeDepartureState:function(){var e=this,t=Object(f.j)(this.completeSweepcodeDepartureInfo);if(this.completeSweepcodeDepartureInfo.length>0){var s=this.completeSweepcodeDepartureInfo.indexOf(this.completeSweepcodeDepartureInfo.filter(function(t){return t.taskId==e.taskId})[0]);-1!=s&&(t[s].patienVerified&&1==t[s].patienVerified&&(this.isPatienVerified=!0),t[s].startPonitVerified&&1==t[s].startPonitVerified&&(this.isStartPonitVerified=!0),t[s].backStartPonitVerified&&1==t[s].backStartPonitVerified&&(this.isBackStartPonitVerified=!0))}},getAppointTaskMessage:function(e){var t=this;Object(r.u)(e).then(function(e){if(e&&200==e.data.code){for(var s in t.appointDetailsMessage=e.data.data,t.appointDetailsMessage)if("checkItems"==s){var a=!0,o=!1,n=void 0;try{for(var p,c=i()(t.appointDetailsMessage[s]);!(a=(p=c.next()).done);a=!0){var r=p.value;r.isChecked=!1,r.isCompleted=!1,t.appointDetailsMessage.extendData1?r.checkDepName=t.appointDetailsMessage.extendData1.checkDepName:r.checkDepName=null,t.appointDetailsMessage.extendData1?r.room=t.appointDetailsMessage.extendData1.room:r.room=null}}catch(e){o=!0,n=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw n}}}if(console.log(t.appointDetailsMessage),t.completeSweepcodeDestinationInfo.length>0)for(var l=0,h=t.completeSweepcodeDestinationInfo.length;l<h;l++)if(t.appointDetailsMessage.id==t.completeSweepcodeDestinationInfo[l].taskId&&t.completeSweepcodeDestinationInfo[l].officeList.length>0)for(var f=0,d=t.completeSweepcodeDestinationInfo[l].officeList.length;f<d;f++)if(t.appointDetailsMessage.checkItems.length>0)for(var u=0,m=t.appointDetailsMessage.checkItems.length;u<m;u++)if(t.appointDetailsMessage.checkItems[u].id==t.completeSweepcodeDestinationInfo[l].officeList[f]&&(t.appointDetailsMessage.checkItems[u].isChecked=!0,t.completeCheckedItemInfo.length>0)){var k=t.completeCheckedItemInfo.indexOf(t.completeCheckedItemInfo.filter(function(e){return e.taskId==t.taskId})[0]);if(-1!=k){var I=t.completeCheckedItemInfo[k].officeList;if(I.length>0){var g=!0,v=!1,D=void 0;try{for(var w,C=i()(I);!(g=(w=C.next()).done);g=!0){var T=w.value;t.appointDetailsMessage.checkItems[u].id==T&&(t.appointDetailsMessage.checkItems[u].isCompleted=!0)}}catch(e){v=!0,D=e}finally{try{!g&&C.return&&C.return()}finally{if(v)throw D}}}}}}else t.$toast(""+e.data.msg)}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},checkCompleted:function(e){var t=this;if(7!=this.appointTaskMessage.state&&6!=this.appointTaskMessage.state)if(e.isChecked)if(e.isCompleted)this.$toast("该科室已经完成过检查");else{var s={proId:this.proId,workerId:this.workerId,itemId:e.id};Object(r.d)(s).then(function(s){s&&200==s.data.code?(t.$toast(""+s.data.msg),t.storeCheckedDepartment(e.id),t.getAppointTaskMessage(t.appointTaskMessage.id)):t.$dialog.alert({message:""+s.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})}else this.$toast("请先完成该检查科室二维码校验");else this.$toast("该任务已完成或取消，不能执行此操作")},storeCheckedDepartment:function(e){var t=this;if(null!=e){var s=[],a=[];if(s=Object(f.j)(this.completeCheckedItemInfo),this.completeCheckedItemInfo.length>0){var i=this.completeCheckedItemInfo.indexOf(this.completeCheckedItemInfo.filter(function(e){return e.taskId==t.taskId})[0]);-1!=i?((a=s[i].officeList).push(e),s[i].officeList=Object(f.p)(a)):(a.push(e),s.push({officeList:Object(f.p)(a),taskId:this.taskId}))}else a.push(e),s.push({officeList:Object(f.p)(a),taskId:this.taskId});this.changeCompleteCheckedItemInfo(s),Object(f.q)("completAppointTaskCheckedItemInfo",{sweepCodeInfo:s})}},endTask:function(){var e=this;if(7!=this.appointTaskMessage.state&&6!=this.appointTaskMessage.state)if(this.completeSweepcodeDepartureInfo&&this.completeSweepcodeDepartureInfo.length>0){var t=this.completeSweepcodeDepartureInfo.indexOf(this.completeSweepcodeDepartureInfo.filter(function(t){return t.taskId==e.taskId})[0]);-1!==t&&(this.completeSweepcodeDepartureInfo[t].patienVerified||this.completeSweepcodeDepartureInfo[t].startPonitVerified)?this.$dialog.alert({message:"是否确认完成任务",closeOnPopstate:!0,showCancelButton:!0}).then(function(){e.completeTask()}).catch(function(e){}):this.$toast("请至少完成出发地科室二维码或病人二维码校验才能完成任务")}else this.$toast("请至少完成出发地科室二维码或病人二维码校验才能完成任务");else this.$toast("该任务已完成或取消，不能执行此操作")},completeTask:function(){var e=this,t={proId:this.proId,workerId:this.workerId,taskId:this.taskId};Object(r.a)(t).then(function(t){t&&200==t.data.code?(e.$toast(""+t.data.msg),e.emptyCompleteCheckedItem(),e.emptyCompleteDestinationDepartment(),e.emptyCompleteDepartureDepartment(),e.$router.push({path:"/appointTask"}),e.changeTitleTxt({tit:"预约任务"}),Object(f.q)("currentTitle","预约任务")):e.$dialog.alert({message:""+t.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},joinSweepCode:function(e,t){var s=this;if(7!=this.appointTaskMessage.state&&6!=this.appointTaskMessage.state)if(2==e)if(this.completeSweepcodeDepartureInfo&&this.completeSweepcodeDepartureInfo.length>0){var a=this.completeSweepcodeDepartureInfo.indexOf(this.completeSweepcodeDepartureInfo.filter(function(e){return e.taskId==s.taskId})[0]);-1!==a&&(this.completeSweepcodeDepartureInfo[a].patienVerified||this.completeSweepcodeDepartureInfo[a].startPonitVerified)?t.isChecked?this.$toast("该检查科室已经校验过"):(this.$router.push({path:"/appointTaskSweepCode",query:{checkType:e,id:t.id}}),this.changeTitleTxt({tit:"扫码"}),Object(f.q)("currentTitle","扫码")):this.$toast("请先进行出发地科室二维码或病人二维码校验")}else this.$toast("请先进行出发地科室二维码或病人二维码校验");else{if(0==e)if(this.completeSweepcodeDepartureInfo&&this.completeSweepcodeDepartureInfo.length>0){var i=this.completeSweepcodeDepartureInfo.indexOf(this.completeSweepcodeDepartureInfo.filter(function(e){return e.taskId==s.taskId})[0]);-1!==i&&this.completeSweepcodeDepartureInfo[i].patienVerified?this.$toast("该病人二维码已经校验并通过,请进行检查科室二维码的校验"):(this.$router.push({path:"/appointTaskSweepCode",query:{checkType:e}}),this.changeTitleTxt({tit:"扫码"}),Object(f.q)("currentTitle","扫码"))}else this.$router.push({path:"/appointTaskSweepCode",query:{checkType:e}}),this.changeTitleTxt({tit:"扫码"}),Object(f.q)("currentTitle","扫码");if(1==e)if(this.completeSweepcodeDepartureInfo&&this.completeSweepcodeDepartureInfo.length>0){var o=this.completeSweepcodeDepartureInfo.indexOf(this.completeSweepcodeDepartureInfo.filter(function(e){return e.taskId==s.taskId})[0]);-1!==o&&this.completeSweepcodeDepartureInfo[o].startPonitVerified?this.$toast("该出发地科室二维码已经校验并通过,请进行检查科室二维码的校验"):(this.$router.push({path:"/appointTaskSweepCode",query:{checkType:e}}),this.changeTitleTxt({tit:"扫码"}),Object(f.q)("currentTitle","扫码"))}else this.$router.push({path:"/appointTaskSweepCode",query:{checkType:e}}),this.changeTitleTxt({tit:"扫码"}),Object(f.q)("currentTitle","扫码");if(3==e)if(this.completeSweepcodeDepartureInfo&&this.completeSweepcodeDepartureInfo.length>0){var n=this.completeSweepcodeDepartureInfo.indexOf(this.completeSweepcodeDepartureInfo.filter(function(e){return e.taskId==s.taskId})[0]);-1!==n&&(this.completeSweepcodeDepartureInfo[n].patienVerified||this.completeSweepcodeDepartureInfo[n].startPonitVerified)?this.completeSweepcodeDepartureInfo[n].backStartPonitVerified?this.$toast("返回科室出发地扫码已经校验过"):(this.$router.push({path:"/appointTaskSweepCode",query:{checkType:e}}),this.changeTitleTxt({tit:"扫码"}),Object(f.q)("currentTitle","扫码")):this.$toast("请至少完成出发地科室二维码或病人二维码的校验才能在次扫描出发地科室二维码")}else this.$toast("请至少完成出发地科室二维码或病人二维码的校验才能在次扫描出发地科室二维码")}else this.$toast("该任务已完成或取消，不能执行此操作")},emptyCompleteCheckedItem:function(){var e=this,t=Object(f.j)(this.completeCheckedItemInfo);t=t.filter(function(t){return t.taskId!=e.taskId}),this.changeCompleteCheckedItemInfo(t),Object(f.q)("completAppointTaskCheckedItemInfo",{sweepCodeInfo:t})},emptyCompleteDestinationDepartment:function(){var e=this,t=Object(f.j)(this.completeSweepcodeDestinationInfo);t=t.filter(function(t){return t.taskId!=e.taskId}),this.changeCompleteSweepcodeDestinationInfo(t),Object(f.q)("completAppointTaskSweepCodeDestinationInfo",{sweepCodeInfo:t})},emptyCompleteDepartureDepartment:function(){var e=this,t=Object(f.j)(this.completeSweepcodeDepartureInfo);t=t.filter(function(t){return t.taskId!=e.taskId}),this.changeCompleteSweepcodeDepartureInfo(t),Object(f.q)("completAppointTaskSweepCodeDepartureInfo",{sweepCodeInfo:t})}})}),u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content-wrapper"},[s("HeaderTop",{attrs:{title:e.navTopTitle}},[s("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),s("div",{staticClass:"basic-message"},[s("p",{staticClass:"basic-message-title"},[e._v("基本信息")]),e._v(" "),s("div",{staticClass:"wait-handle-message"},[s("div",{staticClass:"handle-message-line-wrapper"},[s("P",[s("span",{staticClass:"message-tit"},[e._v("病人床号:")]),e._v(" "),s("span",{staticClass:"message-tit-real"},[e._v(e._s(e.appointDetailsMessage.badNumber))])]),e._v(" "),s("p",[s("span",{staticClass:"message-tit"},[e._v("优先级:")]),e._v(" "),s("span",{staticClass:"message-tit-real message-tit-real-style",class:{natureNormalStyle:1==e.appointDetailsMessage.priority,natureImportantStyle:1!=e.appointDetailsMessage.priority}},[e._v(e._s(e.priorityTransfer(e.appointDetailsMessage.priority)))])])],1),e._v(" "),s("div",{staticClass:"handle-message-line-wrapper"},[s("p",{staticClass:"p-other"},[s("span",{staticClass:"message-tit"},[e._v("预计开始时间: "+e._s(e.appointDetailsMessage.planStartTime))])])]),e._v(" "),s("div",{staticClass:"handle-message-line-wrapper"},[s("p",[s("span",{staticClass:"message-tit"},[e._v("任务起点:")]),e._v(" "),s("span",{staticClass:"message-tit-real"},[e._v(e._s(e.appointDetailsMessage.setOutPlaceName))])]),e._v(" "),s("p",[s("span",{staticClass:"message-tit"},[e._v("转运工具:")]),e._v(" "),s("span",{staticClass:"message-tit-real"},[e._v(e._s(e.appointDetailsMessage.toolName?e.appointDetailsMessage.toolName:"无"))])])]),e._v(" "),s("div",{staticClass:"handle-message-line-wrapper"},[s("p",[s("span",{staticClass:"message-tit"},[e._v("任务描述:")]),e._v(" "),s("span",{staticClass:"message-tit-real"},[e._v(e._s(e.appointDetailsMessage.taskRemark))])])])])]),e._v(" "),s("div",{staticClass:"office-list-item-start-point",class:{listItemStyle:1==e.isPatienVerified||1==e.isStartPonitVerified}},[s("div",{staticClass:"office-list-left"},[s("p",[e._v(e._s(e.appointDetailsMessage.planStartTime))]),e._v(" "),s("p",[e._v(e._s(e.appointDetailsMessage.setOutPlaceName))])]),e._v(" "),s("div",{staticClass:"office-list-right"},[s("p",{class:{listRightStyle:1==e.isPatienVerified},on:{click:function(t){return e.joinSweepCode(0,e.appointDetailsMessage)}}},[e._v("病人扫码")]),e._v(" "),s("p",{class:{listRightStyle:1==e.isStartPonitVerified},on:{click:function(t){return e.joinSweepCode(1,e.appointDetailsMessage)}}},[e._v("科室扫码")])])]),e._v(" "),s("div",{staticClass:"office-list"},[s("div",{staticClass:"office-list-inner-wrapper"},e._l(e.appointDetailsMessage.checkItems,function(t,a){return s("div",{key:t+"-"+a,staticClass:"office-list-item",class:{listItemStyle:1==t.isChecked&&1==t.isCompleted}},[s("div",{staticClass:"office-list-left"},[s("p",[e._v(e._s(t.bookTime))]),e._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:!t.checkDepName||!t.room,expression:"!item.checkDepName || !item.room"}]},[e._v(e._s(t.depName))]),e._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:null!=t.checkDepName&&null!=t.room,expression:"item.checkDepName != null && item.room != null"}]},[e._v(e._s(t.checkDepName)+"-"+e._s(t.room))])]),e._v(" "),s("div",{staticClass:"office-list-right"},[s("p",{class:{listRightStyle:1==t.isChecked},on:{click:function(s){return e.joinSweepCode(2,t)}}},[e._v("科室扫码")]),e._v(" "),s("p",{class:{listRightStyle:1==t.isCompleted},on:{click:function(s){return e.checkCompleted(t)}}},[e._v("检查完成")])])])}),0)]),e._v(" "),s("div",{staticClass:"office-list-item-end-point",class:{listItemStyle:1==e.isBackStartPonitVerified}},[s("div",{staticClass:"office-list-left"},[s("p",[e._v(e._s(e.appointDetailsMessage.setOutPlaceName))])]),e._v(" "),s("div",{staticClass:"office-list-right"},[s("p",{class:{listRightStyle:1==e.isBackStartPonitVerified},on:{click:function(t){return e.joinSweepCode(3,e.appointDetailsMessage)}}},[e._v("科室扫码")])])]),e._v(" "),s("div",{staticClass:"circultion-task-btn"},[s("p",{directives:[{name:"show",rawName:"v-show",value:7!=e.appointTaskMessage.state,expression:"appointTaskMessage.state != 7"}],staticClass:"circultion-task-btn-bottom"},[s("span",{on:{click:e.endTask}},[e._v("完成任务")])]),e._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:7==e.appointTaskMessage.state,expression:"appointTaskMessage.state == 7"}],staticClass:"circultion-task-btn-bottom"},[s("span",{on:{click:e.backTo}},[e._v("返回")])])])],1)},staticRenderFns:[]};var m=s("C7Lr")(d,u,!1,function(e){s("utVQ")},"data-v-6a891a0a",null);t.default=m.exports},utVQ:function(e,t){}});