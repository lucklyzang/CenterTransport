webpackJsonp([8],{UjHx:function(s,t){},izTJ:function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("HzJ8"),i=e.n(a),n=e("4YfN"),o=e.n(n),c=e("0eBz"),r=e("0DTB"),p=(e("L0wb"),e("fFvN")),h=e("sqAx"),l={name:"MyAudio",props:{src:{type:String,default:""},text:{type:String,default:"轻触播放"},showDuration:{type:Boolean,default:!0},block:{type:Boolean,default:!1}},data:function(){return{audio:null,animate:!1,timer:null,duration:null}},watch:{src:function(s){this.src=s}},mounted:function(){var s=this;this.audio=new Audio,this.audio.src=this.src,this.audio.addEventListener("canplaythrough",function(){s.duration=s.format(s.audio.duration)}),this.audio.onplay=function(){s.animate=!0,s.timer=setInterval(function(){s.animate=!1,setTimeout(function(){s.animate=!0},50)},1250)},this.audio.onpause=function(){s.animate=!1,s.timer&&clearInterval(s.timer)},this.audio.onended=function(){s.animate=!1,s.timer&&clearInterval(s.timer)}},methods:{play:function(){this.audio.paused?this.audio.play():this.audio.pause()},format:function(s){var t="";if(s>-1){var e=Math.floor(s/60)%60,a=s%60;e<10&&(t+="0"),t+=e+"'",a<10&&(t+="0"),t+=a.toFixed(2)}return t=t.replace(".",'"')}}},d={render:function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{ref:"wrap",staticClass:"x-audio-wrap",class:{inline:!s.block},on:{click:s.play}},[e("div",{staticClass:"x-sector",class:{play:s.animate}},[e("div",{staticClass:"x-dot"})]),s._v(" "),e("div",{staticClass:"x-time"},[s._v(s._s(s.duration&&s.showDuration?s.duration:s.text))])])},staticRenderFns:[]};var u=e("C7Lr")(l,d,!1,function(s){e("vlrJ")},"data-v-43d8f4c3",null).exports,m=e("SJI6"),g=e("fdFc"),v=(e("M9A7"),{name:"dispatchDetails",data:function(){return{leftDropdownDataList:["退出登录"],leftDownShow:!1,liIndex:null,trackList:[],showChildrenComponent:!1,overlayShow:!1,enlargeImgShow:!1,photoBox:!1,enlargeImgUrl:"",issueImageList:[],historyIssueImageList:[]}},components:{HeaderTop:c.a,NoData:h.a,FooterBottom:r.a,MyAudio:u},computed:o()({},Object(m.mapGetters)(["navTopTitle","userInfo","completeDeparnmentInfo","isCompleteSweepCodeDestinationList","departmentInfoListNo","dispatchTaskMessage","isSingleDestination","dispatchTaskState","dispatchTaskDepartmentType","isCompleteSweepCode","isBack","dispatchTaskId","currentDepartmentNumber","catch_components","isCompleteDispatchIssuePhotoList","templateType"]),{proId:function(){return this.userInfo.extendData.proId},userName:function(){return this.userInfo.userName},proName:function(){return this.userInfo.extendData.proName},workerId:function(){return this.userInfo.extendData.userId},taskId:function(){return this.dispatchTaskMessage.id}}),mounted:function(){var s=this;if(this.$refs.basicMessage.style.height="400px",!Object(g.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),7==s.dispatchTaskMessage.state?s.changeIsFreshDispatchTaskPage(!1):s.changeIsFreshDispatchTaskPage(!0),s.$router.push({path:"/dispatchTask"}),s.changeTitleTxt({tit:"调度任务"}),Object(g.q)("currentTitle","调度任务")})}document.addEventListener("click",function(t){"van-icon van-icon-plus"!=t.target.className&&"quit-account"!=t.target.className&&(s.photoBox=!1,s.overlayShow=!1)}),this.echoPhoto(),this.getTaskMessage()},beforeRouteLeave:function(s,t,e){"dispatchTaskSweepCode"==s.name&&this.changeIsCallDispatchSweepcodeMethod(!0),e()},methods:o()({},Object(m.mapMutations)(["changeTitleTxt","changeIsCompleteSweepCodeDestinationList","changeisCompleteSweepCode","changeIsFreshDispatchTaskPage","changeDispatchTaskMessage","changeIsCoerceTakePhoto","changeDispatchTaskDepartmentType","changeDispatchTaskState","changeCurrentDepartmentNumber","changeCatchComponent","changeIsCallDispatchSweepcodeMethod","changeIsCompleteDispatchIssuePhotoList"]),{previewFileOne:function(){var s=document.getElementById("demo1").files[0],t=this,e=new FileReader;s.size/1024/1024<16?(e.addEventListener("load",function(){var s=e.result,a=new Image;a.src=s,a.onload=function(){var s=Object(g.h)(a,void 0);t.issueImageList.push(s),t.storePhoto(t.issueImageList)}},!1),s&&e.readAsDataURL(s)):this.$dialog.alert({message:"上传图片大小不能超过16MB!",closeOnPopstate:!0}).then(function(){})},previewFileTwo:function(){var s=document.getElementById("demo2").files[0],t=this,e=new FileReader;s.size/1024/1024<16?(e.addEventListener("load",function(){var s=e.result,a=new Image;a.src=s,a.onload=function(){var s=Object(g.h)(a,void 0);t.issueImageList.push(s),t.storePhoto(t.issueImageList)}},!1),s&&e.readAsDataURL(s)):t.$dialog.alert({message:"上传图片大小不能超过16MB!",closeOnPopstate:!0}).then(function(){})},enlargeCompleteImgEvent:function(s){this.enlargeImgShow=!0,this.enlargeImgUrl=s},photoCancel:function(){this.photoBox=!1,this.overlayShow=!1},issueClickEvent:function(){this.photoBox=!0,this.overlayShow=!0},issueDelete:function(s){this.issueImageList.splice(s,1),this.storePhoto(this.issueImageList)},echoPhoto:function(){var s=this;if(this.historyIssueImageList=[],this.issueImageList=[],0!=this.isCompleteDispatchIssuePhotoList.length){var t=this.isCompleteDispatchIssuePhotoList.indexOf(this.isCompleteDispatchIssuePhotoList.filter(function(t){return t.taskId==s.taskId})[0]);-1!==t&&this.isCompleteDispatchIssuePhotoList[t].issuePhototList&&(this.issueImageList=Object(g.j)(this.isCompleteDispatchIssuePhotoList[t].issuePhototList))}},storePhoto:function(s){var t=this,e=[];if(e=Object(g.j)(this.isCompleteDispatchIssuePhotoList),this.isCompleteDispatchIssuePhotoList.length>0){var a=this.isCompleteDispatchIssuePhotoList.indexOf(this.isCompleteDispatchIssuePhotoList.filter(function(s){return s.taskId==t.taskId})[0]);-1!==a?e[a].issuePhototList=s:e.push({issuePhototList:s,taskId:this.taskId})}else e.push({issuePhototList:s,taskId:this.taskId});this.changeIsCompleteDispatchIssuePhotoList(e),Object(g.q)("completdispatchIssuePhotoInfo",{photoInfo:e})},getTaskMessage:function(){var s=this;Object(p.m)(this.dispatchTaskId).then(function(t){t&&200==t.data.code&&(s.showChildrenComponent=!0,s.changeDispatchTaskMessage({DtMsg:t.data.data}),console.log("飒飒飒飒",s.dispatchTaskMessage))}).catch(function(t){s.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},backTo:function(){7==this.dispatchTaskMessage.state?this.changeIsFreshDispatchTaskPage(!1):this.changeIsFreshDispatchTaskPage(!0),this.$router.push({path:"/dispatchTask"}),this.changeTitleTxt({tit:"调度任务"}),Object(g.q)("currentTitle","调度任务")},takePhoto:function(){this.$router.push({path:"/dispatchTakePhoto"}),this.changeTitleTxt({tit:"拍照"}),Object(g.q)("currentTitle","拍照")},endTask:function(){var s=this;if("template_one"==this.templateType){if(0==this.dispatchTaskMessage.distName.length)return void this.$toast("至少完成一个目的地时,才能结束任务")}else if("template_two"==this.templateType)if(this.dispatchTaskMessage.destinations.length>0){if(this.dispatchTaskMessage.distName.length<this.dispatchTaskMessage.destinations.length)return void this.$toast("扫完规定的目的地时,才能结束任务")}else if(0==this.dispatchTaskMessage.distName.length)return void this.$toast("至少完成一个目的地时,才能结束任务");4==this.dispatchTaskMessage.state?this.$toast("请再次扫描出发地结束任务"):this.$dialog.alert({message:"确定结束任务?",showCancelButton:!0}).then(function(){7==s.dispatchTaskMessage.state?s.changeIsFreshDispatchTaskPage(!1):s.changeIsFreshDispatchTaskPage(!0),s.judgeIsGoDeparture()}).catch(function(s){})},judgeIsGoDeparture:function(){1==this.isBack?this.updateTaskState({proId:this.proId,id:this.dispatchTaskMessage.id,state:4}):this.updateTaskState({proId:this.proId,id:this.dispatchTaskMessage.id,state:this.dispatchTaskState})},updateTaskState:function(s){var t=this;Object(p.K)(s).then(function(s){if(s&&200==s.data.code){if(1==t.dispatchTaskDepartmentType&&t.isSingleDestination&&4!=t.dispatchTaskState||7==t.dispatchTaskState){t.$toast("该条任务已完成");var e=Object(g.j)(t.isCompleteSweepCodeDestinationList);e=e.filter(function(s){return s.taskId!=t.taskId}),t.changeIsCompleteSweepCodeDestinationList(e),Object(g.q)("completeDispatchSweepCodeDestinationInfo",{sweepCodeInfo:e});var a=Object(g.j)(t.currentDepartmentNumber);a=a.filter(function(s){return s.taskId!=t.taskId}),t.changeCurrentDepartmentNumber(a),Object(g.q)("completDepartmentNumber",{number:a})}var i=Object(g.j)(t.isCompleteSweepCode);i=i.filter(function(s){return s.taskId!=t.taskId}),t.changeisCompleteSweepCode(i),Object(g.q)("completeDispatchSweepCodeInfo",{sweepCodeInfo:i}),t.$router.push({path:"/dispatchTask"}),t.changeTitleTxt({tit:"调度任务"}),Object(g.q)("currentTitle","调度任务")}else t.$dialog.alert({message:s.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(s){t.$dialog.alert({message:""+s.message,closeOnPopstate:!0}).then(function(){})})},getDepartmentName:function(){var s,t=this,e=[];if(-1!=this.isCompleteSweepCodeDestinationList.indexOf(this.isCompleteSweepCodeDestinationList.filter(function(s){return s.taskId==t.taskId})[0])){s=this.isCompleteSweepCodeDestinationList.filter(function(s){return s.taskId==t.taskId})[0].officeList;var a=!0,n=!1,o=void 0;try{for(var c,r=i()(s);!(a=(c=r.next()).done);a=!0){var p=c.value;e.push(Object(g.a)(this.departmentInfoListNo,p.toString()))}}catch(s){n=!0,o=s}finally{try{!a&&r.return&&r.return()}finally{if(n)throw o}}this.trackList=e}},stateTransfer:function(s){switch(s){case 0:return"未分配";case 1:return"未查阅";case 2:return"未开始";case 3:return"进行中";case 4:return"未结束";case 5:return"已延迟";case 6:return"已取消";case 7:return"已完成"}},priorityTransfer:function(s){switch(s){case 1:return"正常";case 2:return"重要";case 3:return"紧急";case 4:return"紧急重要"}},genderTransfer:function(s){switch(s){case 1:return"男";case 2:return"女";default:return"未知"}},fetchPiece:function(){3==this.dispatchTaskMessage.state||4==this.dispatchTaskMessage.state?this.$toast("取件已完成，请点击送件"):this.joinSweepCode()},sendPiece:function(){2==this.dispatchTaskMessage.state?this.$toast("请先完成出发地取件"):this.joinSweepCode()},joinSweepCode:function(){7==this.dispatchTaskMessage.state?this.$dialog.alert({message:"该条调度任务已完成,不能进行扫码",closeOnPopstate:!0}).then(function(){}):(2==this.dispatchTaskMessage.state?(this.changeIsCoerceTakePhoto(this.dispatchTaskMessage.startPhoto),this.changeDispatchTaskDepartmentType(0),this.changeDispatchTaskState(3)):3==this.dispatchTaskMessage.state?(this.changeIsCoerceTakePhoto(this.dispatchTaskMessage.endPhoto),this.changeDispatchTaskDepartmentType(1),0==this.dispatchTaskMessage.isBack?this.changeDispatchTaskState(7):this.changeDispatchTaskState(4)):4==this.dispatchTaskMessage.state&&(this.changeIsCoerceTakePhoto(this.dispatchTaskMessage.startPhoto),this.changeDispatchTaskDepartmentType(0),this.changeDispatchTaskState(7)),this.$router.push({path:"/dispatchTaskSweepCode"}),this.changeTitleTxt({tit:"扫码"}),Object(g.q)("currentTitle","扫码"))}})}),k={render:function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"content-wrapper"},[e("van-overlay",{attrs:{show:s.overlayShow}}),s._v(" "),e("HeaderTop",{attrs:{title:s.navTopTitle}},[e("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:s.backTo},slot:"left"})],1),s._v(" "),e("div",{ref:"basicMessage",staticClass:"basic-message"},[e("p",{staticClass:"basic-message-title"},[s._v("基本信息")]),s._v(" "),e("div",{staticClass:"wait-handle-message"},["template_one"===s.templateType?e("div",{staticClass:"handle-message-line-wrapper"},[e("P",[e("span",{staticClass:"message-tit"},[s._v("任务类型:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(s.dispatchTaskMessage.taskTypeName))])]),s._v(" "),e("p",[e("span",{staticClass:"message-tit"},[s._v("优先级:")]),s._v(" "),e("span",{staticClass:"message-tit-real",staticStyle:{color:"#ff0000"}},[s._v(s._s(s.priorityTransfer(s.dispatchTaskMessage.priority)))])])],1):s._e(),s._v(" "),e("div",{staticClass:"handle-message-line-wrapper handle-message-line-wrapper-other"},[e("P",[e("span",{staticClass:"message-tit"},[s._v("任务起点:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(s.dispatchTaskMessage.setOutPlaceName))])])],1),s._v(" "),"template_one"===s.templateType?e("div",{staticClass:"handle-message-line-wrapper handle-message-line-wrapper-other"},[e("P",[e("span",{staticClass:"message-tit"},[s._v("任务终点:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(s.dispatchTaskMessage.destinationName))])])],1):"template_two"===s.templateType?e("div",{staticClass:"handle-message-line-wrapper handle-message-line-wrapper-other handle-message-line-wrapper-other-two"},[e("P",[e("span",{staticClass:"message-tit"},[s._v("任务终点:")]),s._v(" "),s._l(s.dispatchTaskMessage.destinations,function(t,a){return e("span",{staticClass:"message-tit-real message-tit-real-destinationList"},[s._v(s._s(t.destinationName)+",")])})],2)],1):s._e(),s._v(" "),e("div",{staticClass:"handle-message-line-wrapper"},[e("p",[e("span",{staticClass:"message-tit"},[s._v("任务状态:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(s.stateTransfer(s.dispatchTaskMessage.state)))])])]),s._v(" "),e("div",{staticClass:"handle-message-line-wrapper handle-message-line-wrapper-other"},[e("p",[e("span",{staticClass:"message-tit"},[s._v("任务时间:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(s.dispatchTaskMessage.planStartTime))])])]),s._v(" "),"template_one"===s.templateType?e("div",{staticClass:"handle-message-line-wrapper"},[e("P",[e("span",{staticClass:"message-tit"},[s._v("病人姓名:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(""==s.dispatchTaskMessage.patientName?"无":s.dispatchTaskMessage.patientName))])]),s._v(" "),e("p",[e("span",{staticClass:"message-tit"},[s._v("床号:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(""==s.dispatchTaskMessage.bedNumber?"无":s.dispatchTaskMessage.bedNumber))])])],1):s._e(),s._v(" "),e("div",{staticClass:"handle-message-line-wrapper"},[e("p",[e("span",{staticClass:"message-tit"},[s._v("数量:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(""==s.dispatchTaskMessage.actualCount?"无":s.dispatchTaskMessage.actualCount))])]),s._v(" "),e("p",[e("span",{staticClass:"message-tit"},[s._v("转运工具:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(""==s.dispatchTaskMessage.toolName?"无":s.dispatchTaskMessage.toolName))])])]),s._v(" "),e("div",{staticClass:"handle-message-line-wrapper"},[e("p",{staticClass:"describe-line-wrapper"},[e("span",{staticClass:"message-tit"},[s._v("语音备注:")]),s._v(" "),s.showChildrenComponent?e("span",{staticClass:"message-tit-real-audio"},[e("MyAudio",{directives:[{name:"show",rawName:"v-show",value:s.dispatchTaskMessage.recordTime>0,expression:"dispatchTaskMessage.recordTime > 0"}],attrs:{src:"http://blink.blinktech.cn/"+s.dispatchTaskMessage.taskNumber+".mp3"}})],1):s._e(),s._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:0==s.dispatchTaskMessage.recordTime,expression:"dispatchTaskMessage.recordTime == 0"}],staticClass:"message-tit-real"},[s._v("\n              无语音信息\n            ")])])]),s._v(" "),"template_two"===s.templateType?e("div",{staticClass:"transport-type-wrapper"},[e("p",{staticClass:"transport-type-title"},[s._v("\n           运送类型:\n         ")]),s._v(" "),s._l(s.dispatchTaskMessage.patientInfoList,function(t,a){return e("div",{staticClass:"transport-type-list-wrapper"},[e("div",{staticClass:"transport-type-list"},[e("p",{staticClass:"transport-type-list-title"},[s._v(s._s(""==t.typeList[0].parentTypeName?"无":t.typeList[0].parentTypeName))]),s._v(" "),e("p",{staticClass:"transport-type-list-content"},[e("span",{staticClass:"serial"},[s._v(s._s(a+1)+"、")]),s._v(" "),e("span",[s._v("\n                  床号:"+s._s(t.bedNumber)+","+s._s(t.patientName)+","+s._s(s.genderTransfer(t.sex))+",\n                ")]),s._v(" "),s._l(t.typeList,function(t,a){return e("span",[s._v("\n                  "+s._s(t.taskTypeName)+"×"+s._s(t.quantity)+"\n                ")])})],2)])])})],2):s._e(),s._v(" "),e("div",{staticClass:"handle-message-line-wrapper"},[e("p",{staticClass:"describe-line-wrapper"},[e("span",{staticClass:"message-tit"},[s._v("任务描述:")]),s._v(" "),e("span",{staticClass:"message-tit-real"},[s._v(s._s(s.dispatchTaskMessage.taskRemark?s.dispatchTaskMessage.taskRemark:"无"))])])])])]),s._v(" "),e("div",{staticClass:"office-list"},[e("div",{staticClass:"basic-message-title"},[s._v("地点轨迹")]),s._v(" "),e("div",{staticClass:"office-list-inner-wrapper"},[7!==s.dispatchTaskMessage.state?e("p",{staticClass:"track-name"},[e("span",[s._v(s._s(s.dispatchTaskMessage.hasSanOut?s.dispatchTaskMessage.hasSanOut.split(";")[0]:""))]),s._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:""!=s.dispatchTaskMessage.hasSanOut,expression:"dispatchTaskMessage.hasSanOut!=''"}],staticClass:"collect-parcel"},[s._v("(取件)")]),s._v(" "),s._l(s.dispatchTaskMessage.distName,function(t,a){return e("span",{key:"we"+t+"-"+a},[s._v(s._s(t)+"\n            "),e("span",{staticClass:"send-parcel"},[s._v("(送件)")])])})],2):e("p",{staticClass:"track-name"},[e("span",[s._v(s._s(s.dispatchTaskMessage.setOutPlaceName))]),s._v(" "),e("span",{staticClass:"collect-parcel"},[s._v("(取件)")]),s._v(" "),s._l(s.dispatchTaskMessage.distName,function(t,a){return e("span",{key:"we"+t+"-"+a},[s._v(s._s(t)+"\n            "),e("span",{staticClass:"send-parcel"},[s._v("(送件)")])])}),s._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:1==s.dispatchTaskMessage.isBack,expression:"dispatchTaskMessage.isBack == 1"}]},[s._v(s._s(s.dispatchTaskMessage.setOutPlaceName))]),s._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:1==s.dispatchTaskMessage.isBack,expression:"dispatchTaskMessage.isBack == 1"}],staticClass:"collect-parcel"},[s._v("(取件)")])],2)])]),s._v(" "),e("div",{staticClass:"circultion-task-btn"},[e("p",{directives:[{name:"show",rawName:"v-show",value:7!=s.dispatchTaskMessage.state,expression:"dispatchTaskMessage.state != 7"}],staticClass:"circultion-task-btn-top"},[e("span",{on:{click:s.fetchPiece}},[s._v("取件")]),s._v(" "),e("span",{on:{click:s.sendPiece}},[s._v("送件")])]),s._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:!s.isSingleDestination&&7!=s.dispatchTaskMessage.state&&2!=s.dispatchTaskMessage.state,expression:"!isSingleDestination && dispatchTaskMessage.state != 7 && dispatchTaskMessage.state != 2"}],staticClass:"circultion-task-btn-bottom"},[e("span",{on:{click:s.endTask}},[s._v("完成任务")])]),s._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:7==s.dispatchTaskMessage.state,expression:"dispatchTaskMessage.state == 7"}],staticClass:"circultion-task-btn-bottom"},[e("span",{on:{click:s.backTo}},[s._v("返回")])])]),s._v(" "),e("transition",{attrs:{name:"van-slide-up"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:s.photoBox,expression:"photoBox"}],staticClass:"choose-photo-box"},[e("div",{staticClass:"choose-photo"},[e("van-icon",{attrs:{name:"photo"}}),s._v(" "),e("input",{attrs:{name:"uploadImg1",id:"demo1",type:"file",accept:"image/album"},on:{change:s.previewFileOne}}),s._v("从图库中选择\n        ")],1),s._v(" "),e("div",{staticClass:"photo-graph"},[e("van-icon",{attrs:{name:"photograph"}}),s._v(" "),e("input",{attrs:{name:"uploadImg2",id:"demo2",type:"file",accept:"image/camera"},on:{change:s.previewFileTwo}}),s._v("拍照\n        ")],1),s._v(" "),e("div",{staticClass:"photo-cancel",on:{click:s.photoCancel}},[s._v("取消")])])]),s._v(" "),e("van-dialog",{attrs:{width:"90%"},model:{value:s.enlargeImgShow,callback:function(t){s.enlargeImgShow=t},expression:"enlargeImgShow"}},[e("img",{attrs:{src:s.enlargeImgUrl}})])],1)},staticRenderFns:[]};var T=e("C7Lr")(v,k,!1,function(s){e("UjHx")},"data-v-df74ce0e",null);t.default=T.exports},vlrJ:function(s,t){}});