webpackJsonp([15],{jV0v:function(e,t){},oO57:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("4YfN"),s=i.n(n),o=i("0eBz"),a=i("0DTB"),p=i("fFvN"),c=i("sqAx"),r=i("NxGh"),d=i("upvi"),l=i("fdFc"),f=(i("M9A7"),{data:function(){return{leftDropdownDataList:["退出登录"],leftDownShow:!1,showLoadingHint:!1,liIndex:null,destinationList:[{name:"科室一",id:1},{name:"科室二",id:2},{name:"科室三",id:3}],taskCancelPng:i("faDW"),taskSweepCodePng:i("g5KD")}},components:{HeaderTop:o.a,NoData:c.a,Loading:r.a,FooterBottom:a.a},mounted:function(){var e=this;if(!Object(l.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),e.$router.push({path:"/appointTask"}),e.changeTitleTxt({tit:"预约任务"}),Object(l.p)("currentTitle","预约任务")})}var t=this;window.scanQRcodeCallback=function(e){t.scanQRcodeCallback(e)},0==this.appointTaskDepartmentType?this.currentSiteId=this.appointTaskMessage.setOutPlaceId:2==this.appointTaskDepartmentType&&(this.currentSiteId=this.appointTaskMessage.setOutPlaceId),console.log("信息校验",this.appointTaskMessage)},computed:s()({},Object(d.b)(["navTopTitle","appointTaskMessage","appointTaskState","appointTaskDepartmentType","appointSweepCodeNumber","appointSweepCodeIntoPage","isCompleteSweepCodeList","isAppointTaskFirstSweepCode","completeSweepcodeDestinationInfo","surplusDestinationList"]),{proId:function(){return JSON.parse(Object(l.j)("userInfo")).extendData.proId},taskId:function(){return this.appointTaskMessage.id}}),methods:s()({},Object(d.c)(["changeTitleTxt","changeIsCompleteSweepCodeList","changeIsAppointTaskFirstSweepCode","changeCompleteSweepcodeDestinationInfo"]),{leftLiCLick:function(e){this.liIndex=e,localStorage.clear(),this.$router.push({path:"/"})},skipMyInfo:function(){this.leftDownShow=!this.leftDownShow},scanQRcodeCallback:function(e){var t=this;if(e){var i=e.split("|");if(i.length>0){var n=i[0];if(this.appointSweepCodeNumber){var s,o="";if(-1!=(s=this.completeSweepcodeDestinationInfo.indexOf(this.completeSweepcodeDestinationInfo.filter(function(e){return e.taskId==t.taskId})[0]))&&(o=this.completeSweepcodeDestinationInfo[s].officeList.indexOf(n)),-1!==s&&-1!==o&&""!==o&&1==this.appointTaskDepartmentType)return void this.$dialog.alert({message:"该目的地已经扫码校验通过,请扫码其它目的地",closeOnPopstate:!0}).then(function(){})}this.juddgeCurrentDepartment({id:this.taskId,proId:this.proId,departmentId:n,checkType:this.appointTaskDepartmentType})}}else this.$dialog.alert({message:"当前没有扫描到任何信息,请重新扫描"}).then(function(){t.sweepAstoffice()})},juddgeCurrentDepartment:function(e){var t=this;this.showLoadingHint=!0,Object(p.k)(e).then(function(i){if(i&&200==i.data.code){if(t.changeIsAppointTaskFirstSweepCode(!1),Object(l.p)("isAppointFirstSweepCode",!1),t.appointSweepCodeIntoPage&&0==t.appointTaskDepartmentType){var n=[],s=[];if(n=Object(l.h)(t.isCompleteSweepCodeList),t.isCompleteSweepCodeList.length>0){var o=t.isCompleteSweepCodeList.indexOf(t.isCompleteSweepCodeList.filter(function(e){return e.taskId==t.taskId})[0]);-1!=o?((s=n[o].officeList).push(t.currentSiteId),n[o].officeList=Object(l.n)(s)):(s.push(t.currentSiteId),n.push({officeList:Object(l.n)(s),taskId:t.taskId}))}else s.push(t.currentSiteId),n.push({officeList:Object(l.n)(s),taskId:t.taskId});return t.changeIsCompleteSweepCodeList(n),Object(l.p)("completAppointTaskSweepCodeInfo",{sweepCodeInfo:n}),t.$router.push({path:"/appointTaskCustomerInfo"}),t.changeTitleTxt({tit:"客户预约信息确认"}),void Object(l.p)("currentTitle","客户预约信息确认")}if(t.appointSweepCodeNumber){t.$router.push({path:"/appointTask"}),t.changeTitleTxt({tit:"预约任务"}),Object(l.p)("currentTitle","预约任务");var a=[],p=[];if(a=Object(l.h)(t.completeSweepcodeDestinationInfo),t.completeSweepcodeDestinationInfo.length>0){var c=t.completeSweepcodeDestinationInfo.indexOf(t.completeSweepcodeDestinationInfo.filter(function(e){return e.taskId==t.taskId})[0]);-1!=c?((p=a[c].officeList).push(e.departmentId),a[c].officeList=Object(l.n)(p)):(p.push(e.departmentId),a.push({officeList:Object(l.n)(p),taskId:t.taskId}))}else p.push(e.departmentId),a.push({officeList:Object(l.n)(p),taskId:t.taskId});return t.changeCompleteSweepcodeDestinationInfo(a),void Object(l.p)("completAppointTaskSweepCodeDestinationInfo",{sweepCodeInfo:a})}t.updateTaskState({proId:t.proId,id:t.appointTaskMessage.id,state:t.appointTaskState})}else t.$dialog.alert({message:i.data.msg,closeOnPopstate:!0,showCancelButton:!0}).then(function(){t.againSweepCode()}).catch(function(e){});t.showLoadingHint=!1}).catch(function(e){t.showLoadingHint=!1,t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},updateTaskState:function(e){var t=this;Object(p.A)(e).then(function(e){e&&200==e.data.code?(7==t.appointTaskState&&(t.$dialog.alert({message:"该任务已完成",closeOnPopstate:!0}).then(function(){}),t.emptyCompleteDestinationDepartment()),t.$router.push({path:"/appointTask"}),t.changeTitleTxt({tit:"预约任务"}),Object(l.p)("currentTitle","预约任务")):t.$dialog.alert({message:e.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!0}).then(function(){})})},emptyCompleteDestinationDepartment:function(){var e=this,t=Object(l.h)(this.completeSweepcodeDestinationInfo);t=t.filter(function(t){return t.taskId!=e.taskId}),this.changeCompleteSweepcodeDestinationInfo(t),Object(l.p)("completAppointTaskSweepCodeDestinationInfo",{sweepCodeInfo:t})},backTo:function(){this.$router.push({path:"/appointTask"}),this.changeTitleTxt({tit:"预约任务"}),Object(l.p)("currentTitle","预约任务")},againSweepCode:function(){this.sweepAstoffice()},sweepAstoffice:function(){window.android.scanQRcode()},sweepCodeSure:function(){var e=this;if(this.isAppointTaskFirstSweepCode)this.sweepAstoffice();else if(this.appointSweepCodeIntoPage){var t,i="";-1!=(t=this.isCompleteSweepCodeList.indexOf(this.isCompleteSweepCodeList.filter(function(t){return t.taskId==e.taskId})[0]))&&(i=this.isCompleteSweepCodeList[t].officeList.indexOf(this.currentSiteId)),-1!==t&&-1!==i&&""!==i&&0==this.appointTaskDepartmentType?(this.$dialog.alert({message:"该科室校验已验证通过,请确认客户预约信息",closeOnPopstate:!0}).then(function(){}),this.$router.push({path:"/appointTaskCustomerInfo"}),this.changeTitleTxt({tit:"客户预约信息确认"}),Object(l.p)("currentTitle","客户预约信息确认")):this.sweepAstoffice()}else this.sweepAstoffice()},cancelSweepCode:function(){this.$router.push({path:"/appointTask"}),this.changeTitleTxt({tit:"预约任务"}),Object(l.p)("currentTitle","预约任务")}})}),h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content-wrapper"},[i("HeaderTop",{attrs:{title:e.navTopTitle}},[i("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.leftDownShow,expression:"leftDownShow"}],staticClass:"left-dropDown"},e._l(e.leftDropdownDataList,function(t,n){return i("li",{key:n,class:{liStyle:e.liIndex==n},on:{click:function(t){return e.leftLiCLick(n)}}},[e._v(e._s(t))])}),0),e._v(" "),i("div",{staticClass:"loading"},[i("loading",{attrs:{isShow:e.showLoadingHint,textContent:"校验中,请稍候····",textColor:"#2895ea"}})],1),e._v(" "),i("div",{staticClass:"sweep-code-area"},[i("div",{staticClass:"point-area"},[i("p",{staticClass:"task-start-point"},[i("span",[e._v("任务起点:")]),e._v(" "),i("span",[e._v(e._s(e.appointTaskMessage.setOutPlaceName))])]),e._v(" "),i("p",{staticClass:"task-end-point",staticStyle:{"line-height":"20px"}},[i("span",[e._v("任务目的地:")]),e._v(" "),e._l(e.surplusDestinationList,function(t,n){return i("span",{key:n,staticStyle:{"margin-right":"8px"}},[e._v(e._s(t.text))])})],2)])]),e._v(" "),i("div",{staticClass:"btn-area"},[i("span",[i("img",{attrs:{src:e.taskSweepCodePng,alt:""},on:{click:e.sweepCodeSure}})]),e._v(" "),i("span",[i("img",{attrs:{src:e.taskCancelPng,alt:""},on:{click:e.cancelSweepCode}})])])],1)},staticRenderFns:[]};var u=i("C7Lr")(f,h,!1,function(e){i("jV0v")},"data-v-6fb6d934",null);t.default=u.exports}});