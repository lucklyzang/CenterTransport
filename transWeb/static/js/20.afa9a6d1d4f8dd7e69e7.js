webpackJsonp([20],{JZBV:function(e,t){},cY62:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("4YfN"),i=a.n(s),n=a("0eBz"),l=a("yl8L"),c=a("gh9j"),o=a("0DTB"),r=a("fFvN"),u=a("sqAx"),p=a("SJI6"),g=a("fdFc"),m=(a("M9A7"),{name:"circulationTaskCollectMessageSure",data:function(){return{leftDropdownDataList:["退出登录"],leftDownShow:!1,showSignatureBox:!1,isClickCancelBtn:!1,liIndex:null,isDialogShow:!1,showSignature:!1,allcirculationCollectMessageList:[],bedNumber:"",patientName:"",sampleAmount:"",sampleMessageList:[{sampleType:"",innerSampleAmount:"",sampleTypeList:[],entryList:[],checkEntryList:[]}],temporaryCollectInfo:[],taskSurePng:a("WoXg"),taskCancelPng:a("faDW")}},components:{VanFieldSelectPicker:l.a,HeaderTop:n.a,NoData:u.a,FooterBottom:o.a,ElectronicSignature:c.a},mounted:function(){var e=this;console.log("id",this.circulationTaskId),Object(g.b)()||(pushHistory(),this.gotoURL(function(){pushHistory(),e.isDialogShow||e.loseDataInfo()})),this.echoCollectMessage()},computed:i()({},Object(p.mapGetters)(["navTopTitle","originalSignature","currentElectronicSignature","circulationCollectMessageList","circulationTaskMessage","completeDeparnmentInfo","verifyCirculationOfficeId","circulationDetails"]),{proId:function(){return JSON.parse(Object(g.l)("userInfo")).extendData.proId},circulationTaskId:function(){return this.circulationDetails.id}}),methods:i()({},Object(p.mapMutations)(["changeTitleTxt","changeCirculationCollectMessageList","changeCompleteDeparnmentInfo","changeCurrentElectronicSignature"]),{skipMyInfo:function(){},loseDataInfo:function(){var e=this;this.isDialogShow=!1,this.showSignatureBox=!0,this.$dialog.alert({message:"返回上级后,将丢失本页及本科室的数据",closeOnPopstate:!1,showCancelButton:!0}).then(function(){e.temporaryCollectInfo=Object(g.j)(e.circulationCollectMessageList.filter(function(t){return t.taskId!=e.circulationTaskId})),e.changeCurrentElectronicSignature({DtMsg:null}),e.changeCirculationCollectMessageList({DtMsg:e.temporaryCollectInfo}),Object(g.q)("currentCirculationCollectMessage",{innerMessage:e.temporaryCollectInfo}),e.$router.push({path:"/circulationTaskCollectMessage"}),e.changeTitleTxt({tit:"循环信息采集"}),Object(g.q)("currentTitle","循环信息采集"),e.isDialogShow=!0,e.showSignatureBox=!0}).catch(function(){e.isDialogShow=!1,e.showSignatureBox=!0})},updateCirculationtaskState:function(e){var t=this;Object(r.J)(e).then(function(e){e&&e.data.code}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!1}).then(function(){})})},rewrite:function(){this.$refs.mychild.overwrite()},echoCollectMessage:function(){var e=this;this.allcirculationCollectMessageList=[];var t=this.circulationCollectMessageList.indexOf(this.circulationCollectMessageList.filter(function(t){return t.taskId==e.circulationTaskId})[0]);this.allcirculationCollectMessageList=Object(g.j)(this.circulationCollectMessageList[t].collectDepartmentList),console.log("wq",this.allcirculationCollectMessageList)},getSampleMessage:function(e){var t=this;Object(r.e)(e).then(function(e){if(e&&200==e.data.code){t.$dialog.alert({message:e.data.msg,closeOnPopstate:!0}).then(function(){}),t.allcirculationCollectMessageList=[],t.temporaryCollectInfo=Object(g.j)(t.circulationCollectMessageList.filter(function(e){return e.taskId!=t.circulationTaskId})),t.changeCurrentElectronicSignature({DtMsg:null}),t.changeCirculationCollectMessageList({DtMsg:t.temporaryCollectInfo}),Object(g.q)("currentCirculationCollectMessage",{innerMessage:t.temporaryCollectInfo});var a=[],s=[];s=Object(g.j)(t.completeDeparnmentInfo);var i=t.completeDeparnmentInfo.indexOf(t.completeDeparnmentInfo.filter(function(e){return e.taskId==t.circulationTaskId})[0]);t.completeDeparnmentInfo.length>0&&-1!=i?((a=s[i].departmentIdList).push(t.verifyCirculationOfficeId),s[i].departmentIdList=a):(a.push(t.verifyCirculationOfficeId),s.push({departmentIdList:a,taskId:t.circulationTaskId})),t.changeCompleteDeparnmentInfo({DtMsg:s}),Object(g.q)("completeDepartmentMessage",{sureInfo:s}),t.$router.push({path:"/circulationDetails"}),t.changeTitleTxt({tit:"任务详情"}),Object(g.q)("currentTitle","任务详情")}else t.$dialog.alert({message:e.data.msg,closeOnPopstate:!1}).then(function(){})}).catch(function(e){t.$dialog.alert({message:""+e.message,closeOnPopstate:!1}).then(function(){})})},backTo:function(){this.loseDataInfo()},collectMessageSure:function(){var e=this,t={proId:this.proId,taskId:this.circulationTaskId,departmentId:this.verifyCirculationOfficeId,singImg:"",specList:[]},a=this.circulationCollectMessageList.indexOf(this.circulationCollectMessageList.filter(function(t){return t.taskId==e.circulationTaskId})[0]),s=Object(g.j)(this.circulationCollectMessageList[a].collectDepartmentList);if(s.length>0){for(var i=0,n=s.length;i<n;i++)if(t.specList.push({patientName:s[i].patientName,bedNumber:s[i].bedNumber,totalNum:s[i].sampleAmount,specimen:[]}),s[i].sampleMessageList.length>0)for(var l=0,c=s[i].sampleMessageList.length;l<c;l++)t.specList[i].specimen.push({specimenId:s[i].sampleMessageList[l].value,specimenName:s[i].sampleMessageList[l].text,quantity:s[i].sampleMessageList[l].sampleNumber,checkItems:{}});console.log("最终标本信息",t)}this.getSampleMessage(t)},collectMessageCancel:function(){var e=this;this.$dialog.alert({message:"取消确认后,将丢失本页及本科室的采集数据",closeOnPopstate:!1,showCancelButton:!0}).then(function(){e.allcirculationCollectMessageList=[],e.temporaryCollectInfo=Object(g.j)(e.circulationCollectMessageList.filter(function(t){return t.taskId!=e.circulationTaskId})),e.changeCurrentElectronicSignature({DtMsg:null}),e.changeCirculationCollectMessageList({DtMsg:e.temporaryCollectInfo}),Object(g.q)("currentCirculationCollectMessage",{innerMessage:e.temporaryCollectInfo}),e.$router.push({path:"/circulationTaskCollectMessage"}),e.changeTitleTxt({tit:"信息采集"}),Object(g.q)("currentTitle","信息采集")}).catch(function(){})}})}),f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-wrapper"},[a("HeaderTop",{attrs:{title:e.navTopTitle}},[a("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:e.backTo},slot:"left"})],1),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.leftDownShow,expression:"leftDownShow"}],staticClass:"left-dropDown"},e._l(e.leftDropdownDataList,function(t,s){return a("li",{key:s,class:{liStyle:e.liIndex==s},on:{click:function(t){return e.leftLiCLick(s)}}},[e._v(e._s(t))])}),0),e._v(" "),e._m(0),e._v(" "),a("div",{staticClass:"bed-number-list-outer"},e._l(e.allcirculationCollectMessageList,function(t,s){return a("div",{key:t+"-"+s,staticClass:"bed-number-list"},[a("div",{staticClass:"form-two"},[a("van-field",{attrs:{disabled:"",label:"床号"},model:{value:t.bedNumber,callback:function(a){e.$set(t,"bedNumber",a)},expression:"outerItem.bedNumber"}}),e._v(" "),a("van-field",{attrs:{disabled:"",type:"tel",label:"姓名"},model:{value:t.patientName,callback:function(a){e.$set(t,"patientName",a)},expression:"outerItem.patientName"}}),e._v(" "),a("van-field",{attrs:{disabled:"",type:"number",label:"标本总数"},model:{value:t.sampleAmount,callback:function(a){e.$set(t,"sampleAmount",a)},expression:"outerItem.sampleAmount"}})],1),e._v(" "),a("div",{staticClass:"sweep-code-area"},[e._m(1,!0),e._v(" "),a("div",{staticClass:"circulation-area"},e._l(t.sampleMessageList,function(t,s){return a("p",{key:t+"-"+s},[a("span",[e._v(e._s(t.text))]),e._v(" "),a("span",[a("van-stepper",{attrs:{min:"0",disabled:""},model:{value:t.sampleNumber,callback:function(a){e.$set(t,"sampleNumber",a)},expression:"innerItem.sampleNumber"}})],1)])}),0)])])}),0),e._v(" "),e.showSignature?a("div",{staticClass:"electronic-signature"},[a("ElectronicSignature",{ref:"mychild"})],1):e._e(),e._v(" "),e.showSignature?a("div",{staticClass:"rewrite-box"},[a("span",{on:{click:e.rewrite}},[e._v("重写")])]):e._e(),e._v(" "),a("div",{staticClass:"btn-area"},[a("span",[a("img",{attrs:{src:e.taskSurePng,alt:""},on:{click:e.collectMessageSure}})]),e._v(" "),a("span",[a("img",{attrs:{src:e.taskCancelPng,alt:""},on:{click:e.collectMessageCancel}})])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"sweep-code-title"},[t("h3",[this._v("科室信息采集确认")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"circulation-area-title"},[t("span",[this._v("标本名称")]),this._v(" "),t("span",[this._v("数量")])])}]};var d=a("C7Lr")(m,f,!1,function(e){a("JZBV")},"data-v-390a437e",null);t.default=d.exports}});