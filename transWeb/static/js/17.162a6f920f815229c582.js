webpackJsonp([17],{GxeM:function(t,e){},oO57:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("4YfN"),i=s.n(a),o=s("0eBz"),n=s("0DTB"),p=s("fFvN"),c=s("sqAx"),r=s("NxGh"),d=s("upvi"),l=s("fdFc"),h=(s("M9A7"),{data:function(){return{leftDropdownDataList:["退出登录"],leftDownShow:!1,showLoadingHint:!1,liIndex:null,taskCancelPng:s("faDW"),taskSweepCodePng:s("g5KD")}},components:{HeaderTop:o.a,NoData:c.a,Loading:r.a,FooterBottom:n.a},mounted:function(){var t=this;if(!Object(l.b)()){pushHistory(),this.gotoURL(function(){pushHistory(),t.$router.push({path:"/appointTask"}),t.changeTitleTxt({tit:"预约任务"}),Object(l.o)("currentTitle","预约任务")})}var e=this;window.scanQRcodeCallback=function(t){e.scanQRcodeCallback(t)},0==this.appointTaskDepartmentType?this.currentSiteId=this.appointTaskMessage.setOutPlaceId:1==this.appointTaskDepartmentType?this.currentSiteId=this.appointTaskMessage.destinationId:2==this.appointTaskDepartmentType&&(this.currentSiteId=this.appointTaskMessage.setOutPlaceId),console.log("信息校验",this.appointTaskMessage)},computed:i()({},Object(d.b)(["navTopTitle","appointTaskMessage","appointTaskState","appointTaskDepartmentType","appointSweepCodeNumber","appointSweepCodeIntoPage","isCompleteSweepCodeList","isAppointTaskFirstSweepCode"]),{proId:function(){return JSON.parse(Object(l.i)("userInfo")).extendData.proId},taskId:function(){return this.appointTaskMessage.id}}),methods:i()({},Object(d.c)(["changeTitleTxt","changeIsCompleteSweepCodeList","changeIsAppointTaskFirstSweepCode"]),{leftLiCLick:function(t){this.liIndex=t,localStorage.clear(),this.$router.push({path:"/"})},skipMyInfo:function(){this.leftDownShow=!this.leftDownShow},scanQRcodeCallback:function(t){var e=this;if(t){var s=t.split("|");if(s.length>0){var a=s[0];this.juddgeCurrentDepartment({id:this.taskId,proId:this.proId,departmentId:a,checkType:this.appointTaskDepartmentType})}}else this.$dialog.alert({message:"当前没有扫描到任何信息,请重新扫描"}).then(function(){e.sweepAstoffice()})},juddgeCurrentDepartment:function(t){var e=this;this.showLoadingHint=!0,Object(p.k)(t).then(function(t){if(t&&200==t.data.code){e.changeIsAppointTaskFirstSweepCode(!1),Object(l.o)("isAppointFirstSweepCode",!1);var s=[],a=[];if(s=Object(l.g)(e.isCompleteSweepCodeList),e.isCompleteSweepCodeList.length>0){var i=e.isCompleteSweepCodeList.indexOf(e.isCompleteSweepCodeList.filter(function(t){return t.taskId==e.taskId})[0]);-1!=i?((a=s[i].officeList).push(e.currentSiteId),s[i].officeList=Object(l.m)(a)):(a.push(e.currentSiteId),s.push({officeList:Object(l.m)(a),taskId:e.taskId}))}else a.push(e.currentSiteId),s.push({officeList:Object(l.m)(a),taskId:e.taskId});if(e.changeIsCompleteSweepCodeList(s),Object(l.o)("completAppointTaskSweepCodeInfo",{sweepCodeInfo:s}),e.appointSweepCodeIntoPage)return e.$router.push({path:"/appointTaskCustomerInfo"}),e.changeTitleTxt({tit:"客户预约信息确认"}),void Object(l.o)("currentTitle","客户预约信息确认");if(e.appointSweepCodeNumber)return e.$router.push({path:"/appointTask"}),e.changeTitleTxt({tit:"预约任务"}),Object(l.o)("currentTitle","预约任务"),void e.emptyCompleteDepartment();e.updateTaskState({proId:e.proId,id:e.appointTaskMessage.id,state:e.appointTaskState})}else e.$dialog.alert({message:t.data.msg,closeOnPopstate:!0,showCancelButton:!0}).then(function(){e.againSweepCode()}).catch(function(t){});e.showLoadingHint=!1}).catch(function(t){e.showLoadingHint=!1,e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},updateTaskState:function(t){var e=this;Object(p.A)(t).then(function(t){t&&200==t.data.code?(7==e.appointTaskState&&e.$dialog.alert({message:"该任务已完成",closeOnPopstate:!0}).then(function(){}),e.emptyCompleteDepartment(),e.$router.push({path:"/appointTask"}),e.changeTitleTxt({tit:"预约任务"}),Object(l.o)("currentTitle","预约任务")):e.$dialog.alert({message:t.data.msg,closeOnPopstate:!0}).then(function(){})}).catch(function(t){e.$dialog.alert({message:""+t.message,closeOnPopstate:!0}).then(function(){})})},emptyCompleteDepartment:function(){var t=this,e=Object(l.g)(this.isCompleteSweepCodeList);e=e.filter(function(e){return e.taskId!=t.taskId}),this.changeIsCompleteSweepCodeList(e),Object(l.o)("completAppointTaskSweepCodeInfo",{sweepCodeInfo:e})},backTo:function(){this.$router.push({path:"/appointTask"}),this.changeTitleTxt({tit:"预约任务"}),Object(l.o)("currentTitle","预约任务")},againSweepCode:function(){this.sweepAstoffice()},sweepAstoffice:function(){window.android.scanQRcode()},sweepCodeSure:function(){var t=this;if(this.isAppointTaskFirstSweepCode)this.sweepAstoffice();else{var e,s="";-1!=(e=this.isCompleteSweepCodeList.indexOf(this.isCompleteSweepCodeList.filter(function(e){return e.taskId==t.taskId})[0]))&&(s=this.isCompleteSweepCodeList[e].officeList.indexOf(this.currentSiteId)),-1!==e&&-1!==s&&""!==s&&0==this.appointTaskDepartmentType?(this.$dialog.alert({message:"该科室校验已验证通过,请确认客户预约信息",closeOnPopstate:!0}).then(function(){}),this.$router.push({path:"/appointTaskCustomerInfo"}),this.changeTitleTxt({tit:"客户预约信息确认"}),Object(l.o)("currentTitle","客户预约信息确认")):this.sweepAstoffice()}},cancelSweepCode:function(){this.$router.push({path:"/appointTask"}),this.changeTitleTxt({tit:"预约任务"}),Object(l.o)("currentTitle","预约任务")}})}),u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content-wrapper"},[s("HeaderTop",{attrs:{title:t.navTopTitle}},[s("van-icon",{attrs:{slot:"left",name:"arrow-left"},on:{click:t.backTo},slot:"left"})],1),t._v(" "),s("ul",{directives:[{name:"show",rawName:"v-show",value:t.leftDownShow,expression:"leftDownShow"}],staticClass:"left-dropDown"},t._l(t.leftDropdownDataList,function(e,a){return s("li",{key:a,class:{liStyle:t.liIndex==a},on:{click:function(e){return t.leftLiCLick(a)}}},[t._v(t._s(e))])}),0),t._v(" "),s("div",{staticClass:"loading"},[s("loading",{attrs:{isShow:t.showLoadingHint,textContent:"校验中,请稍候····",textColor:"#2895ea"}})],1),t._v(" "),s("div",{staticClass:"sweep-code-area"},[s("div",{staticClass:"point-area"},[s("p",{staticClass:"task-start-point"},[s("span",[t._v("任务起点:")]),t._v(" "),s("span",[t._v(t._s(t.appointTaskMessage.setOutPlaceName))])]),t._v(" "),s("p",{staticClass:"task-end-point"},[s("span",[t._v("任务终点:")]),t._v(" "),s("span",[t._v(t._s(t.appointTaskMessage.destinationName))])])])]),t._v(" "),s("div",{staticClass:"btn-area"},[s("span",[s("img",{attrs:{src:t.taskSweepCodePng,alt:""},on:{click:t.sweepCodeSure}})]),t._v(" "),s("span",[s("img",{attrs:{src:t.taskCancelPng,alt:""},on:{click:t.cancelSweepCode}})])])],1)},staticRenderFns:[]};var f=s("C7Lr")(h,u,!1,function(t){s("GxeM")},"data-v-3b0f8eb5",null);e.default=f.exports}});